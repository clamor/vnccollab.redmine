
    <html>
      <head><title>Test coverage for vnccollab.redmine.util</title>
      <style type="text/css">
        a {text-decoration: none; display: block; padding-right: 1em;}
        a:hover {background: #EFA;}
        hr {height: 1px; border: none; border-top: 1px solid gray;}
        .notcovered {background: #FCC;}
        .footer {margin: 2em; font-size: small; color: gray;}
      </style>
      </head>
      <body><h1>Test coverage for vnccollab.redmine.util</h1>
      <table>
    
<tr><td><a href="vnccollab.html">vnccollab/</a></td> <td style="background: red">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 70% (147 of 492 uncovered)</td></tr>
<tr><td><a href="vnccollab.redmine.html">&nbsp;&nbsp;&nbsp;&nbsp;redmine/</a></td> <td style="background: red">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 70% (147 of 492 uncovered)</td></tr>
<tr><td><a href="vnccollab.redmine.util.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;util.py</a></td> <td style="background: red">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 77% (15 of 67 uncovered)</td></tr>
</table><hr/>
<pre>    1: import sys
       
    1: from pyactiveresource.activeresource import ActiveResource
       
    1: from zope.interface import implements
    1: from Products.CMFPlone.utils import safe_unicode as su
    1: from plone.memoize.instance import memoize
       
    1: from plone import api
       
    1: from vnccollab.redmine.interfaces import IRedmineUtil
    1: from vnccollab.redmine.content import Issue, User
       
       
    2: class RedmineUtil:
    1:     '''Redmine Utility.'''
    1:     implements(IRedmineUtil)
       
    1:     @memoize
           def _get_server_url(self):
    1:         url = api.portal.get_registry_record('vnccollab.redmine.server_url')
    1:         return url
       
    1:     def _get_credentials(self):
    4:         member = api.user.get_current()
    4:         username = member.getProperty('redmine_username', '')
    4:         password = member.getProperty('redmine_password', '')
               # password could contain non-ascii chars, ensure it's properly encoded
    4:         return username, su(password).encode('utf-8')
       
    1:     @memoize
           def _get_user_class(self, url, username, password):
    1:         attrs = {'_site': url, '_user': username, '_password': password}
    1:         UserClass = type("User", (ActiveResource,), attrs.copy())
    1:         return UserClass
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         user = UserClass.find('current')</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         return user</div>       
    1:     def _get_my_user_class(self):
    2:         url = self._get_server_url()
    2:         username, password = self._get_credentials()
    2:         UserClass = self._get_user_class(url, username, password)
    2:         return UserClass
       
    1:     def _get_current_user(self):
    2:         UserClass = self._get_my_user_class()
    2:         return UserClass.find('current')
       
    1:     @memoize
           def _get_issue_class(self, url, username, password):
    1:         attrs = {'_site': url, '_user': username, '_password': password}
    1:         IssueClass = type("Issue", (ActiveResource,), attrs.copy())
    1:         return IssueClass
       
    1:     def _get_my_issue_class(self):
    2:         url = self._get_server_url()
    2:         username, password = self._get_credentials()
    2:         return self._get_issue_class(url, username, password)
       
    1:     def searchIssues(self, **query):
               '''Returns a list of issues that satisfy query.
       
               ARGS:
                   query: Dictionary specifying the query.
                       offset:
                       limit:
                       sort:
                       project_id:
                       subproject_id:
                       tracker_id:
                       assigned_to_id:
                       status_id:
                       created_on_XXX:
                       updated_on_XXX:
                       start_date_XXX:
                       due_date_XXX:
                           XXX: is 'before' | 'after | 'between'
                       subject_words:
                       description_words:
                       journal_words:
                       search_words:
               '''
    2:         IssueClass = self._get_my_issue_class()
    2:         result = IssueClass.find(**query)
    6:         result = [Issue(x) for x in result]
    2:         return result
       
    1:     def searchMyIssues(self, **query):
               '''Returns a list of issues for the current user that satify the
               query.'''
    2:         user = self._get_current_user()
    2:         query['assinged_to_id'] = user.id
    2:         return self.searchIssues(**query)
       
    1:     def getIssue(self, id, **args):
               '''Gets the issue identified by id.
       
               ARGS:
                   id: The id of the Issue to fetch.
                   args: Specifies associated data to the issue. Possible values are:
                       include: Comma separated string with the fields to include.
                           It could be any of:
                               journals
                               children
                               attachments
                               relations
                               changeset
                               watchers
               '''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         IssueClass = self._get_my_issue_class()</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         issue = IssueClass.get(id, **args)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         issue = Issue(issue)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         return issue</div>       
    1:     @memoize
           def getUser(self, id):
               '''Returns a Redmine user.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         UserClass = self._get_my_user_class()</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         user = UserClass.get(id)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         user = User(UserClass.get(id))</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         return user</div>       
       
    1: redmineUtilInstance = RedmineUtil()
       
       
    1: def logException(logger, msg, context=None):
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     logger.exception(msg)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     if context is not None:</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         error_log = getattr(context, 'error_log', None)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         if error_log is not None:</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;             error_log.raising(sys.exc_info())</div></pre>

      <div class="footer">
      Generated for revision Niewersjonowany katalog on 2014-03-19 23:58:19.289888Z
      </div>
    </body>
    </html>

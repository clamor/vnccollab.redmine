
    <html>
      <head><title>Test coverage for vnccollab.redmine.upgrades.replaceportlets</title>
      <style type="text/css">
        a {text-decoration: none; display: block; padding-right: 1em;}
        a:hover {background: #EFA;}
        hr {height: 1px; border: none; border-top: 1px solid gray;}
        .notcovered {background: #FCC;}
        .footer {margin: 2em; font-size: small; color: gray;}
      </style>
      </head>
      <body><h1>Test coverage for vnccollab.redmine.upgrades.replaceportlets</h1>
      <table>
    
<tr><td><a href="vnccollab.html">vnccollab/</a></td> <td style="background: red">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 70% (147 of 492 uncovered)</td></tr>
<tr><td><a href="vnccollab.redmine.html">&nbsp;&nbsp;&nbsp;&nbsp;redmine/</a></td> <td style="background: red">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 70% (147 of 492 uncovered)</td></tr>
<tr><td><a href="vnccollab.redmine.upgrades.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upgrades/</a></td> <td style="background: red">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 34% (45 of 69 uncovered)</td></tr>
<tr><td><a href="vnccollab.redmine.upgrades.replaceportlets.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;replaceportlets.py</a></td> <td style="background: red">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 28% (42 of 59 uncovered)</td></tr>
</table><hr/>
<pre>    1: from zope.component import getUtility, getMultiAdapter
       
    1: from plone import api
    1: from plone.portlets.interfaces import IPortletManager
    1: from plone.portlets.interfaces import ILocalPortletAssignable
    1: from plone.portlets.interfaces import IPortletAssignmentMapping
       
    1: from vnccollab.redmine.portlets import redmine_tickets
       
       
    1: MANAGER_NAMES = ['plone.leftcolumn', 'plone.rightcolumn',
    1:                  'plone.dashboard1', 'plone.dashboard2',
    1:                  'plone.dashboard3', 'plone.dashboard4']
       
       
    1: def replace_all_portlets():
           '''Replace theme's portlets for redmine's.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     replace_all_general_portlets()</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     replace_all_content_portlets()</div>       
       
    1: def replace_all_general_portlets():
           '''Replace portlets for the portal.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     portal = api.portal.get()</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     managers = get_managers(portal)</div>       
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     for manager in managers:</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         for cat_name, category in manager.items():</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;             for map_name, mapping in category.items():</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                 for portlet_name, portlet in mapping.items():</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                     new_portlet = new_redmine_ticket(portlet, portlet_name)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                     if new_portlet is not None:</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                         mapping._data[portlet_name] = new_portlet</div>       
       
       
    1: def replace_all_content_portlets():
           '''Replace portlets in content objects.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     all_content = all_content_with_portlets()</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     for content in all_content:</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         managers = get_managers(content)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         for manager in managers:</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;             mapping = getMultiAdapter((content, manager), IPortletAssignmentMapping)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;             for portlet_name, portlet in mapping.items():</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                 new_portlet = new_redmine_ticket(portlet, portlet_name)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                 if new_portlet is not None:</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                     mapping._data[portlet_name] = new_portlet</div>       
       
       
    1: def new_redmine_ticket(portlet, portlet_name):
           '''Given a theme's redmine ticket portlet and its name, returns a redmine's
           ticket portlet. In other case, it returns None.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     class_name = _class_name(portlet)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     if class_name == 'vnccollab.theme.portlets.redmine_tickets.Assignment':</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         new_portlet = redmine_tickets.Assignment(portlet.header, portlet.count,</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                                                  portlet.request_timeout)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         new_portlet.__name__ = portlet_name</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         print '****** ------ ******', portlet_name, portlet, new_portlet</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         return new_portlet</div>           else:
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;         return None</div>       
       
    1: def _class_name(obj):
           '''Returns the full qualified class name of an object.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     return '{0}.{1}'.format(obj.__module__, obj.__class__.__name__)</div>       
       
    1: def all_content_with_portlets():
           '''Returns all the content objects that have a portlet assigned.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     portal = api.portal.get()</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     catalog = api.portal.get_tool(name='portal_catalog')</div>       
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     all_brains = catalog(show_inactive=True, language="ALL",</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                          object_provides=ILocalPortletAssignable.__identifier__)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     all_content = [brain.getObject() for brain in all_brains]</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     all_content = list(all_content) + [portal]</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     return all_content</div>       
       
    1: def get_managers(content):
           '''Returns the portlet managers.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     managers = [getUtility(IPortletManager, name=manager_name, context=content)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;                     for manager_name in MANAGER_NAMES]</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     return managers</div>       
       
    1: def mapping_from_manager(manager, content):
           '''Returns the mappings associated to a portelt manager.'''
<div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     mapping = getMultiAdapter((content, manager), IPortletAssignmentMapping)</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     items = mapping.items()</div><div class="notcovered">&gt;&gt;&gt;&gt;&gt;&gt;     return items</div></pre>

      <div class="footer">
      Generated for revision Niewersjonowany katalog on 2014-03-19 23:58:19.289888Z
      </div>
    </body>
    </html>
